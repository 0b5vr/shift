"use strict";function _classCallCheck(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(exports,"__esModule",{value:!0});var _createClass=function(){function e(e,r){for(var t=0;t<r.length;t++){var a=r[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(r,t,a){return t&&e(r.prototype,t),a&&e(r,a),r}}(),GLCat=function(){function e(r){_classCallCheck(this,e);var t=this;t.gl=r;var a=t.gl;a.enable(a.DEPTH_TEST),a.depthFunc(a.LEQUAL),a.enable(a.BLEND),a.blendFunc(a.SRC_ALPHA,a.ONE_MINUS_SRC_ALPHA),a.getExtension("OES_texture_float"),a.getExtension("OES_texture_float_linear"),t.extDrawBuffers=a.getExtension("WEBGL_draw_buffers"),t.extInstancedArrays=a.getExtension("ANGLE_instanced_arrays"),t.currentProgram=null}return _createClass(e,[{key:"createProgram",value:function(e,r,t){var a=this,E=a.gl,u=void 0;u="function"==typeof t?t:function(e){console.error(e)};var n=E.createShader(E.VERTEX_SHADER);if(E.shaderSource(n,e),E.compileShader(n),!E.getShaderParameter(n,E.COMPILE_STATUS))return u(E.getShaderInfoLog(n)),null;var f=E.createShader(E.FRAGMENT_SHADER);if(E.shaderSource(f,r),E.compileShader(f),!E.getShaderParameter(f,E.COMPILE_STATUS))return u(E.getShaderInfoLog(f)),null;var T=E.createProgram();return E.attachShader(T,n),E.attachShader(T,f),E.linkProgram(T),E.getProgramParameter(T,E.LINK_STATUS)?(T.locations={},T):(u(E.getProgramInfoLog(T)),null)}},{key:"useProgram",value:function(e){var r=this,t=r.gl;t.useProgram(e),r.currentProgram=e}},{key:"createVertexbuffer",value:function(e){var r=this,t=r.gl,a=t.createBuffer();return e&&r.setVertexbuffer(a,e),a}},{key:"setVertexbuffer",value:function(e,r){var t=this,a=t.gl;a.bindBuffer(a.ARRAY_BUFFER,e),a.bufferData(a.ARRAY_BUFFER,new Float32Array(r),a.STATIC_DRAW),a.bindBuffer(a.ARRAY_BUFFER,null),e.length=r.length}},{key:"createIndexbuffer",value:function(e){var r=this,t=r.gl,a=t.createBuffer();return t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,a),t.bufferData(t.ELEMENT_ARRAY_BUFFER,new Int16Array(e),t.STATIC_DRAW),t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,null),a.length=e.length,a}},{key:"getAttribLocation",value:function(e){var r=this,t=r.gl,a=void 0;return r.currentProgram.locations[e]?a=r.currentProgram.locations[e]:(a=t.getAttribLocation(r.currentProgram,e),r.currentProgram.locations[e]=a),a}},{key:"attribute",value:function(e,r,t,a){var E=this,u=E.gl,n=E.getAttribLocation(e);u.bindBuffer(u.ARRAY_BUFFER,r),u.enableVertexAttribArray(n),u.vertexAttribPointer(n,t,u.FLOAT,!1,0,0);var f=a||0;E.extInstancedArrays.vertexAttribDivisorANGLE(n,f),u.bindBuffer(u.ARRAY_BUFFER,null)}},{key:"getUniformLocation",value:function(e){var r=this,t=r.gl,a=void 0;return r.currentProgram.locations[e]?a=r.currentProgram.locations[e]:(a=t.getUniformLocation(r.currentProgram,e),r.currentProgram.locations[e]=a),a}},{key:"uniform1i",value:function(e,r){var t=this,a=t.gl,E=t.getUniformLocation(e);a.uniform1i(E,r)}},{key:"uniform1f",value:function(e,r){var t=this,a=t.gl,E=t.getUniformLocation(e);a.uniform1f(E,r)}},{key:"uniform2fv",value:function(e,r){var t=this,a=t.gl,E=t.getUniformLocation(e);a.uniform2fv(E,r)}},{key:"uniform3fv",value:function(e,r){var t=this,a=t.gl,E=t.getUniformLocation(e);a.uniform3fv(E,r)}},{key:"uniform4fv",value:function(e,r){var t=this,a=t.gl,E=t.getUniformLocation(e);a.uniform4fv(E,r)}},{key:"uniformCubemap",value:function(e,r,t){var a=this,E=a.gl,u=a.getUniformLocation(e);E.activeTexture(E.TEXTURE0+t),E.bindTexture(E.TEXTURE_CUBE_MAP,r),E.uniform1i(u,t)}},{key:"uniformTexture",value:function(e,r,t){var a=this,E=a.gl,u=a.getUniformLocation(e);E.activeTexture(E.TEXTURE0+t),E.bindTexture(E.TEXTURE_2D,r),E.uniform1i(u,t)}},{key:"createTexture",value:function(){var e=this,r=e.gl,t=r.createTexture();return r.bindTexture(r.TEXTURE_2D,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.bindTexture(r.TEXTURE_2D,null),t}},{key:"textureFilter",value:function(e,r){var t=this,a=t.gl;a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,r),a.bindTexture(a.TEXTURE_2D,null)}},{key:"textureWrap",value:function(e,r){var t=this,a=t.gl;a.bindTexture(a.TEXTURE_2D,e),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,r),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,r),a.bindTexture(a.TEXTURE_2D,null)}},{key:"setTexture",value:function(e,r){var t=this,a=t.gl;a.bindTexture(a.TEXTURE_2D,e),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),a.bindTexture(a.TEXTURE_2D,null)}},{key:"setTextureFromArray",value:function(e,r,t,a){var E=this,u=E.gl;u.bindTexture(u.TEXTURE_2D,e),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,r,t,0,u.RGBA,u.UNSIGNED_BYTE,new Uint8Array(a)),u.bindTexture(u.TEXTURE_2D,null)}},{key:"setTextureFromFloatArray",value:function(e,r,t,a){var E=this,u=E.gl;u.bindTexture(u.TEXTURE_2D,e),u.texImage2D(u.TEXTURE_2D,0,u.RGBA,r,t,0,u.RGBA,u.FLOAT,new Float32Array(a)),u.bindTexture(u.TEXTURE_2D,null)}},{key:"copyTexture",value:function(e,r,t){var a=this,E=a.gl;E.bindTexture(E.TEXTURE_2D,e),E.copyTexImage2D(E.TEXTURE_2D,0,E.RGBA,0,0,r,t,0),E.bindTexture(E.TEXTURE_2D,null)}},{key:"createCubemap",value:function(e){var r=this,t=r.gl,a=t.createTexture();t.bindTexture(t.TEXTURE_CUBE_MAP,a);for(var E=0;6>E;E++)t.texImage2D(t.TEXTURE_CUBE_MAP_POSITIVE_X+E,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,e[E]);return t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MIN_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_MAG_FILTER,t.LINEAR),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_S,t.CLAMP_TO_EDGE),t.texParameteri(t.TEXTURE_CUBE_MAP,t.TEXTURE_WRAP_T,t.CLAMP_TO_EDGE),t.bindTexture(t.TEXTURE_CUBE_MAP,null),a}},{key:"createFramebuffer",value:function(e,r){var t=this,a=t.gl,E={};return E.framebuffer=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,E.framebuffer),E.depth=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,E.depth),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,e,r),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,E.depth),E.texture=t.createTexture(),a.bindTexture(a.TEXTURE_2D,E.texture),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,r,0,a.RGBA,a.UNSIGNED_BYTE,null),a.bindTexture(a.TEXTURE_2D,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,E.texture,0),a.bindFramebuffer(a.FRAMEBUFFER,null),E}},{key:"resizeFramebuffer",value:function(e,r,t){var a=this,E=a.gl;E.bindFramebuffer(E.FRAMEBUFFER,e.framebuffer),E.renderbufferStorage(E.RENDERBUFFER,E.DEPTH_COMPONENT16,r,t),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,r,t,0,E.RGBA,E.UNSIGNED_BYTE,null),E.bindFramebuffer(E.FRAMEBUFFER,null)}},{key:"createFloatFramebuffer",value:function(e,r){var t=this,a=t.gl,E={};return E.framebuffer=a.createFramebuffer(),a.bindFramebuffer(a.FRAMEBUFFER,E.framebuffer),E.depth=a.createRenderbuffer(),a.bindRenderbuffer(a.RENDERBUFFER,E.depth),a.renderbufferStorage(a.RENDERBUFFER,a.DEPTH_COMPONENT16,e,r),a.framebufferRenderbuffer(a.FRAMEBUFFER,a.DEPTH_ATTACHMENT,a.RENDERBUFFER,E.depth),E.texture=t.createTexture(),a.bindTexture(a.TEXTURE_2D,E.texture),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,e,r,0,a.RGBA,a.FLOAT,null),a.bindTexture(a.TEXTURE_2D,null),a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_2D,E.texture,0),a.bindFramebuffer(a.FRAMEBUFFER,null),E}},{key:"resizeFloatFramebuffer",value:function(e,r,t){var a=this,E=a.gl;E.bindFramebuffer(E.FRAMEBUFFER,e.framebuffer),E.renderbufferStorage(E.RENDERBUFFER,E.DEPTH_COMPONENT16,r,t),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,r,t,0,E.RGBA,E.FLOAT,null),E.bindFramebuffer(E.FRAMEBUFFER,null)}},{key:"createDrawBuffers",value:function(e,r,t){var a=this,E=a.gl,u=a.extDrawBuffers;if(u.MAX_DRAW_BUFFERS_WEBGL<t)throw"createDrawBuffers: MAX_DRAW_BUFFERS_WEBGL is "+u.MAX_DRAW_BUFFERS_WEBGL;var n={};n.framebuffer=E.createFramebuffer(),E.bindFramebuffer(E.FRAMEBUFFER,n.framebuffer),n.depth=E.createRenderbuffer(),E.bindRenderbuffer(E.RENDERBUFFER,n.depth),E.renderbufferStorage(E.RENDERBUFFER,E.DEPTH_COMPONENT16,e,r),E.framebufferRenderbuffer(E.FRAMEBUFFER,E.DEPTH_ATTACHMENT,E.RENDERBUFFER,n.depth),n.textures=[];for(var f=0;t>f;f++)n.textures[f]=a.createTexture(),E.bindTexture(E.TEXTURE_2D,n.textures[f]),E.texImage2D(E.TEXTURE_2D,0,E.RGBA,e,r,0,E.RGBA,E.FLOAT,null),E.bindTexture(E.TEXTURE_2D,null),E.framebufferTexture2D(E.FRAMEBUFFER,u.COLOR_ATTACHMENT0_WEBGL+f,E.TEXTURE_2D,n.textures[f],0);var T=E.checkFramebufferStatus(E.FRAMEBUFFER);if(T!==E.FRAMEBUFFER_COMPLETE)throw"createDrawBuffers: gl.checkFramebufferStatus( gl.FRAMEBUFFER ) is "+T;return E.bindFramebuffer(E.FRAMEBUFFER,null),n}},{key:"drawBuffers",value:function(e){var r=this,t=(r.gl,r.extDrawBuffers),a=[];if("number"==typeof e)for(var E=0;e>E;E++)a.push(t.COLOR_ATTACHMENT0_WEBGL+E);else a.concat(e);t.drawBuffersWEBGL(a)}},{key:"clear",value:function(e,r,t,a,E){var u=this,n=u.gl,f=e||0,T=r||0,R=t||0,i="number"==typeof a?a:1,o="number"==typeof E?E:1;n.clearColor(f,T,R,i),n.clearDepth(o),n.clear(n.COLOR_BUFFER_BIT|n.DEPTH_BUFFER_BIT)}},{key:"render",value:function(e){var r=this,t=r.gl;e.viewport&&t.viewport(e.viewport[0],e.viewport[1],e.viewport[2],e.viewport[3]),e.program&&r.useProgram(e.program),e.framebuffer&&t.bindFramebuffer(t.FRAMEBUFFER,e.framebuffer);var a=0;e.clearColor&&(t.clearColor(e.clearColor[0],e.clearColor[1],e.clearColor[2],e.clearColor[3]),a|=t.COLOR_BUFFER_BIT),e.clearDepth&&(t.clearDepth(t.clearDepth),a|=t.DEPTH_BUFFER_BIT),t.clear}}]),e}();exports["default"]=GLCat;